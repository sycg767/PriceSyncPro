# 🚀 PriceSyncPro - New API 智能价格同步插件

**一键同步上游模型定价，专为 New API 设计，支持从 New API 或 One Hub 获取价格数据。**

[![GitHub](https://img.shields.io/badge/GitHub-sycg767%2FPriceSyncPro-blue?logo=github)](https://github.com/sycg767/PriceSyncPro)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Version](https://img.shields.io/badge/Version-2.0.0-orange.svg)](https://github.com/sycg767/PriceSyncPro/releases)

---

## ✨ 核心优势

- **🚀 一键自动配置**：输入上游 URL、前缀和 API 密钥，即可自动创建渠道、供货商和模型配置，无需手动操作后台。
- **⚡ 智能同步**：无论是同步模型列表还是仅更新价格，都可通过智能判断一键完成，无需手动执行 SQL。
- **🔒 更安全**：通过浏览器 Cookie 进行认证，无需暴露和管理 API Token。
- **🎯 更便捷**：直接在 New API 后台页面使用，无需切换任何外部工具。
- **💾 配置预设**：保存并管理多个上游渠道的配置，一键加载，轻松切换。
- **🔄 模型列表同步**：自动从上游获取最新模型列表并更新到指定渠道，解决模型更新不同步的痛点。
- **📊 实时反馈**：清晰的 UI 反馈，让每一步操作的状态都一目了然。

---

## 📦 安装步骤

### 支持的浏览器
- ✅ **Chrome**
- ✅ **Edge**
- ✅ 所有基于 Chromium 内核的浏览器

### 安装流程

1.  **下载项目**
    *   点击本页面右上角的 `Code` -> `Download ZIP`，下载并解压。

2.  **打开扩展管理页面**
    *   **Chrome**: 在地址栏输入 `chrome://extensions/`
    *   **Edge**: 在地址栏输入 `edge://extensions/`

3.  **启用开发者模式**
    *   找到页面右上角的“**开发者模式**”开关并启用。

4.  **加载扩展**
    *   点击“**加载已解压的扩展程序**”按钮。
    *   选择刚刚解压的项目**根目录**（包含 `manifest.json` 文件的目录）。
    *   点击“选择文件夹”。

5.  **完成安装**
    *   **PriceSyncPro** 图标会出现在浏览器工具栏。
    *   建议点击图钉图标将其固定，方便快速访问。

---

## 🚀 快速开始指南

### 第一步：登录 New API 后台

- 打开你的 New API 管理后台并成功登录。
- **重要**: 插件需要使用浏览器的登录状态 (Cookie) 来进行安全认证。

### 第二步：打开插件并选择模式

在 New API 后台的**任意页面**，点击浏览器工具栏的 **PriceSyncPro** 图标。

插件提供两种工作模式：

1.  **🚀 自动配置 (推荐新用户)**: 如果你是第一次对接某个上游，或者想在 New API 中创建一个全新的渠道，请使用此模式。
2.  **⚡ 快速同步 (推荐日常使用)**: 如果你的渠道已经在 New API 中创建好了，只是需要同步模型列表或更新价格，请使用此模式。

### 模式一：🚀 自动配置 (首次对接)

此模式将自动完成**创建渠道**、**创建供货商**、**创建模型配置**以及**同步价格**所有步骤。

1.  **切换到“自动配置”模式**。
2.  **填写上游信息**:
    *   **上游定价 URL**: 上游的 API 地址 (例如: `https://api.example.com/api/pricing`)。
    *   **模型前缀**: 你想为这批模型添加的前缀 (例如: `Silo/`)，这将成为渠道和供货商的名称。
    *   **API 密钥**: 上游渠道的 API Key。
    *   **渠道标签**: 为新渠道设置一个标签 (例如: `官方`)。
3.  **点击“一键自动配置”**。
4.  插件会自动执行所有创建和同步操作，并实时显示进度。
5.  完成后，你的 New API 后台就多了一个配置完整的全新渠道。

### 模式二：⚡ 快速同步 (日常更新)

此模式用于更新一个**已存在**的渠道。

1.  **切换到“快速同步”模式**。
2.  **填写基础配置**:
    *   **上游定价 URL**: 上游的 API 地址。
    *   **模型前缀** (可选): 如果你的模型有前缀，请填写。
    *   可以点击 **💾** 图标将当前配置保存为预设，方便下次一键加载。
3.  **选择目标渠道**:
    *   在“目标渠道”下拉框中，选择你想要更新的那个渠道。
4.  **点击“智能同步”按钮**。

**“智能同步”按钮会自动判断：**

-   **如果选择了渠道**: 它会执行“**完整同步**”，即先同步模型列表，再更新价格。
-   **如果未选择渠道**: 它会执行“**快速更新**”，即只更新价格，不涉及模型列表。

---

## 🎯 核心功能详解

### 🧠 智能价格分析
- 自动分析并推断上游系统的隐藏基础价。
- 兼容按次计费和按量计费两种模式。
- 内置 120+ 主流模型官方价格数据库作为备用参考。
- 自动识别并处理多种模型命名格式。

### 🌐 多上游数据源支持
插件可以从以下系统获取上游定价，然后同步到你的 **New API** 后台：

-   ✅ **New API** - 标准 `/api/pricing` 端点
-   ✅ **One Hub** - 自动兼容两种 API 格式
    -   官方 API：`/api/available_model`
    -   实例 API：`/panel/model_price`

### 💾 配置预设管理
-   **保存**: 输入配置后，点击 💾 图标即可保存为预设。
-   **加载**: 从下拉框中选择预设，即可自动填充配置。
-   **管理**: 点击右上角的 ⚙️ 设置按钮，可以管理或删除已保存的预设。

---

## 📁 项目结构

```
/ (项目根目录)
├── manifest.json            # 插件清单文件
├── popup.html               # 插件主界面
├── popup.js                 # 插件界面逻辑
├── content.js               # 核心 API 通信与同步脚本
├── background.js            # 后台服务脚本
├── icons/                     # 插件图标
├── official_prices.json     # 官方价格数据库
└── README.md                # 本文档
```

---

## ❓ 常见问题 (FAQ)

**Q1: 插件为什么比 API Token 更安全？**
**A:** 插件运行在你的 New API 页面中，直接复用浏览器的登录状态 (Session Cookie) 进行认证，全程无需在插件中输入或存储你的 API Token，避免了 Token 泄露的风险。

**Q2: 会覆盖我其他的渠道配置吗？**
**A:** 完全不会。插件采用智能合并策略，所有操作都精确地限定在你选择的渠道或指定的前缀上，不会影响任何其他模型的配置。

**Q3: 点击插件图标没反应或提示认证失败怎么办？**
**A:** 这通常是因为登录状态已过期。请在 New API 后台页面**刷新一下**，如果需要的话重新登录，然后再打开插件即可。

**Q4: One Hub 的价格单位和 New API 不同，插件能处理吗？**
**A:** 可以。插件内置了智能转换逻辑，会自动处理 One Hub 特殊的价格单位（例如 `$/1K tokens` -> `$/1M tokens`），并将其无缝转换为 New API 所需的格式。

---

## 📄 开源协议

本项目基于 **MIT License** 开源，您可以自由使用、修改和分发。

---

**PriceSyncPro | 让价格管理更简单** 🚀
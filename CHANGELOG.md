# 更新日志 (Changelog)

所有重要的项目变更都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [1.2.1] - 2025-11-16

### 🐛 Bug修复
- **OneHub平台兼容性**：修复/pricing接口数据格式兼容性问题
  - 添加OneHub对象格式自动检测和转换
  - 优化令牌组过滤逻辑，兼容无令牌组信息的数据

---

## [1.2.0] - 2025-11-16

### ✨ 新增功能

#### UI/UX 全面优化
- **高优先级优化**
  - 按钮状态反馈：禁用按钮显示清晰的tooltip说明（带❌图标）
  - 加载状态优化：添加进度条UI组件，实时显示同步进度（10% → 40% → 70% → 100%）
  - 错误消息优化：统一格式，使用换行符替代HTML标签，提升可读性

- **中优先级优化**
  - 渠道选择简化：显示格式从 `渠道名 (ID: X, Y个模型)` 简化为 `渠道名 (Y个)`
  - 预设管理优化：列表和下拉框显示URL域名，提高识别度
  - 快捷键提示：在按钮tooltip中显示 Ctrl+Enter 和 Ctrl+S

- **低优先级优化**
  - 输入提示转tooltip：将3个输入提示转换为title属性，减少视觉干扰
  - 智能价格精度：根据价格大小动态调整显示精度（≥$1显示2位，≥$0.01显示4位，<$0.01显示6位）
  - 代码清理：移除冗余的syncBtn引用

### 🐛 Bug修复
- **403错误处理**：扩展错误回退机制，支持403状态码自动回退到/pricing接口
- **错误标识统一**：将`401_FALLBACK`改为`AUTH_FALLBACK`，更通用的认证错误标识

### 🎨 性能优化
- 使用DocumentFragment批量插入DOM，减少重排次数
- 优化表格渲染性能，提升大量模型时的显示速度

### 📚 文档更新
- 更新README，补充UI/UX优化说明
- 完善CHANGELOG，记录所有新功能和修复

---

## [1.1.0] - 2025-11-06

### ✨ 新增功能

#### One Hub API 完整支持
- **多格式兼容**
  - 支持 One Hub 官方 API 格式（`/api/available_model`）
  - 支持 One Hub 实例 API 格式（`/panel/model_price`）
  - 自动检测和转换两种 One Hub 数据格式
  
- **智能价格转换**
  - 自动处理 One Hub 内部单位（÷500）
  - 智能转换 $/1K 到 $/1M（按量计费模型）
  - 正确处理按次计费模型价格
  - 自动识别免费模型（input ≤ 0 && output ≤ 0）

- **用户体验优化**
  - 插件和 Web 版本均添加 API 端点提示
  - 清晰标注 New API 和 One Hub 的端点路径
  - 简化用户输入，减少错误

### 📚 文档更新
- 更新使用指南，添加 One Hub 使用说明
- 完善 README，补充 One Hub 支持信息
- 更新 CHANGELOG，记录所有新功能

### 🔧 技术改进
- 优化格式检测逻辑，提升兼容性
- 增强错误处理，更友好的错误提示
- 代码重构，提高可维护性

---

## [1.0.0] - 2025-11-05

### 🎉 首个正式版发布

这是 PriceSyncPro 的第一个正式版本，提供完整的价格同步功能。

### ✨ 新增功能

#### 核心功能
- **智能价格推断引擎**
  - 使用"众数投票"算法自动推断上游系统的隐藏基础价
  - 支持置信度评估，确保推断结果可靠
  - 自动匹配 120+ 主流 AI 模型的官方价格

- **双模式计费支持**
  - 按次计费（Per-Use）：直接计算单次调用价格
  - 按量计费（Usage-Based）：计算 ModelRatio 和 CompletionRatio

- **智能 SQL 生成器**
  - 合并模式：只更新当前前缀的模型，保留其他配置
  - 带备份模式：自动创建备份表，安全可靠
  - 支持自定义模型前缀

#### 浏览器插件版
- **一键自动同步**
  - 无需手动执行 SQL，点击按钮即可完成
  - 实时显示同步进度和结果
  - 支持批量同步和单个同步

- **智能配置管理**
  - 自动读取现有配置
  - 智能合并新旧配置
  - 支持多字段编辑对话框

- **性能优化**
  - 按需注入 Content Script，减少 40%+ 资源消耗
  - DocumentFragment 批量渲染，提升 60%+ 性能
  - 智能错误处理，只显示关键警告

#### Web 版
- **现代化 UI 设计**
  - iOS 风格界面，美观易用
  - 响应式布局，支持各种屏幕尺寸
  - 流畅的动画效果

- **数据导出功能**
  - 支持 CSV 格式导出
  - 一键复制表格数据
  - 完整的价格分析报告

- **使用指南和文档**
  - 内置详细使用指南
  - 关于页面展示项目信息
  - 快速开始教程

### 📚 文档
- 完整的 README.md 使用文档
- 浏览器插件安装和使用指南
- Web 版本部署说明
- FAQ 常见问题解答

### 🔧 技术实现
- 使用 Chrome Extension Manifest V3
- 纯原生 JavaScript，无外部依赖
- 模块化代码结构，易于维护
- 完善的错误处理和日志系统

### 📦 发布内容
- 浏览器插件版（推荐）
- Web 版本
- 完整源代码
- 使用文档

---

## 版本号说明

版本格式：`主版本号.次版本号.修订号`

- **主版本号**：重大功能变更或不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

---

## 类型说明

- `✨ 新增`：新功能
- `🐛 修复`：Bug 修复
- `📝 文档`：文档更新
- `🎨 优化`：代码优化、性能提升
- `♻️ 重构`：代码重构
- `🔧 配置`：配置文件修改
- `⚠️ 废弃`：即将移除的功能
- `🗑️ 移除`：移除的功能
- `🔒 安全`：安全相关修复

---

[1.2.0]: https://github.com/sycg767/PriceSyncPro/releases/tag/v1.2.0
[1.1.0]: https://github.com/sycg767/PriceSyncPro/releases/tag/v1.1.0
[1.0.0]: https://github.com/sycg767/PriceSyncPro/releases/tag/v1.0.0